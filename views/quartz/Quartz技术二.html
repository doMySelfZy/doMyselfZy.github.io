<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Quartz（二）：组件API | doMyselfZy</title>
    <meta name="description" content="doMyselfZy的博客，vuepress文档，JavaWiki，文档，Java教程，后端框架，教程">
    <link rel="icon" href="/favicon.png">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?76d3ac92807272f24b9ae15d35b7e3fa";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script>
  <script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?e8d97b6a87d604bff6ab30d0d3bd0dc6";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script>
    
    <link rel="preload" href="/assets/css/0.styles.feb621f0.css" as="style"><link rel="preload" href="/assets/js/app.95d329f1.js" as="script"><link rel="preload" href="/assets/js/6.e87b4649.js" as="script"><link rel="preload" href="/assets/js/1.3a92e369.js" as="script"><link rel="preload" href="/assets/js/22.25490df5.js" as="script"><link rel="prefetch" href="/assets/js/10.9962a6de.js"><link rel="prefetch" href="/assets/js/11.04ff4ae8.js"><link rel="prefetch" href="/assets/js/12.5b0be90f.js"><link rel="prefetch" href="/assets/js/13.2291c3ab.js"><link rel="prefetch" href="/assets/js/14.96135cf7.js"><link rel="prefetch" href="/assets/js/15.2332dacf.js"><link rel="prefetch" href="/assets/js/16.523b68a0.js"><link rel="prefetch" href="/assets/js/17.2d93996e.js"><link rel="prefetch" href="/assets/js/18.0af26f31.js"><link rel="prefetch" href="/assets/js/19.610f2822.js"><link rel="prefetch" href="/assets/js/20.05ffce68.js"><link rel="prefetch" href="/assets/js/21.c447065e.js"><link rel="prefetch" href="/assets/js/23.93a58f62.js"><link rel="prefetch" href="/assets/js/24.9af3938e.js"><link rel="prefetch" href="/assets/js/25.756d8bac.js"><link rel="prefetch" href="/assets/js/26.b4a4df65.js"><link rel="prefetch" href="/assets/js/4.2876667a.js"><link rel="prefetch" href="/assets/js/5.d12cde30.js"><link rel="prefetch" href="/assets/js/7.1198436b.js"><link rel="prefetch" href="/assets/js/8.68340d49.js"><link rel="prefetch" href="/assets/js/9.37dc72fd.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.410fc226.js">
    <link rel="stylesheet" href="/assets/css/0.styles.feb621f0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container"><div><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/avatar.png" alt="doMyselfZy" class="logo"> <span class="site-name">doMyselfZy</span></a> <div class="links"><div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
    首页
  </a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="wikifont wiki-wikipediaw"></i>
        文档wiki
      </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/java/" class="nav-link"><i class="wikifont wiki-java"></i>
    Java
  </a></li><li class="dropdown-item"><!----> <a href="/views/quartz/" class="nav-link router-link-active"><i class="wikifont wiki-tianchongxing-"></i>
    Quartz
  </a></li><li class="dropdown-item"><!----> <a href="/views/nginx/" class="nav-link"><i class="wikifont wiki-nginx"></i>
    Nginx
  </a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="wikifont wiki-xiezi"></i>
    杂谈
  </a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
    时间线
  </a></div><div class="nav-item"><a href="/views/other/about.html" class="nav-link"><i class="iconfont reco-account"></i>
    关于我
  </a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
    首页
  </a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="wikifont wiki-wikipediaw"></i>
        文档wiki
      </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/java/" class="nav-link"><i class="wikifont wiki-java"></i>
    Java
  </a></li><li class="dropdown-item"><!----> <a href="/views/quartz/" class="nav-link router-link-active"><i class="wikifont wiki-tianchongxing-"></i>
    Quartz
  </a></li><li class="dropdown-item"><!----> <a href="/views/nginx/" class="nav-link"><i class="wikifont wiki-nginx"></i>
    Nginx
  </a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="wikifont wiki-xiezi"></i>
    杂谈
  </a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
    时间线
  </a></div><div class="nav-item"><a href="/views/other/about.html" class="nav-link"><i class="iconfont reco-account"></i>
    关于我
  </a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Quartz（二）：组件API</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/quartz/Quartz%E6%8A%80%E6%9C%AF%E4%BA%8C.html#一、scheduler（调度器）" class="sidebar-link">一、Scheduler（调度器）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/quartz/Quartz%E6%8A%80%E6%9C%AF%E4%BA%8C.html#二、job" class="sidebar-link">二、Job</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/quartz/Quartz%E6%8A%80%E6%9C%AF%E4%BA%8C.html#jobexecutioncontext" class="sidebar-link">JobExecutionContext</a></li></ul></li><li><a href="/views/quartz/Quartz%E6%8A%80%E6%9C%AF%E4%BA%8C.html#三、jobdetail（实例化作业）" class="sidebar-link">三、JobDetail（实例化作业）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/quartz/Quartz%E6%8A%80%E6%9C%AF%E4%BA%8C.html#_3-1-jobdatamap" class="sidebar-link">3.1. JobDataMap</a></li><li class="sidebar-sub-header"><a href="/views/quartz/Quartz%E6%8A%80%E6%9C%AF%E4%BA%8C.html#_3-2-key（job或者trigger的唯一表示）" class="sidebar-link">3.2. Key（Job或者Trigger的唯一表示）</a></li></ul></li></ul></section></li></ul> </aside> <div><main class="page reco-hide"> <div class="page-title"><h1>Quartz（二）：组件API</h1> <hr> <div data-v-0b496ca7><i class="iconfont reco-account" data-v-0b496ca7><span data-v-0b496ca7>doMyselfZy</span></i> <i class="iconfont reco-date" data-v-0b496ca7><span data-v-0b496ca7>2018/9/13</span></i> <span id="/views/quartz/Quartz%E6%8A%80%E6%9C%AF%E4%BA%8C.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-2e99e05a data-v-0b496ca7><i class="iconfont reco-eye" style="margin-right: .5rem" data-v-2e99e05a></i> <a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;" data-v-2e99e05a></a></span> <!----></div></div> <div class="content default"><p>本讲主要说明Quartz中重要的几个组件的API。</p> <h2 id="一、scheduler（调度器）"><a href="#一、scheduler（调度器）" aria-hidden="true" class="header-anchor">#</a> 一、Scheduler（调度器）</h2> <p>Scheduler的生命期，从SchedulerFactory创建它时开始，到Scheduler调用shutdown()方法时结束；Scheduler被创建后，可以增加、删除和列举Job和Trigger，以及执行其它与调度相关的操作（如暂停Trigger）。但是，Scheduler只有在调用start()方法后，才会真正地触发trigger（即执行job）。</p> <p>上面说了，Scheduler是由Factory创建的，有两种方式来创建一个Scheduler。</p> <ol><li>直接获取</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 1. 创建 SchedulerFactory</span>
<span class="token class-name">SchedulerFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StdSchedulerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2. 从工厂中获取调度器实例</span>
<span class="token class-name">Scheduler</span> scheduler <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">getScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>自己配置FactoryBean</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * &lt;p&gt;初始化一个构建Scheduler的工厂&lt;/p&gt;
 */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SchedulerFactoryBean</span> <span class="token function">schedulerFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">SchedulerFactoryBean</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SchedulerFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setQuartzProperties</span><span class="token punctuation">(</span><span class="token function">quartzProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setOverwriteExistingJobs</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 通过SchedulerFactoryBean获取Scheduler的实例
 */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Scheduler</span> <span class="token function">scheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">Scheduler</span> scheduler <span class="token operator">=</span> <span class="token function">schedulerFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>scheduler<span class="token punctuation">.</span><span class="token function">isStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        scheduler<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

		scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> scheduler<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>第二种方式，有一个好处，可以初始化指定的配置文件，也不一定必须放在ClassPath的指定位置。</p> <h2 id="二、job"><a href="#二、job" aria-hidden="true" class="header-anchor">#</a> 二、Job</h2> <p>一个job就是一个实现了Job接口的类，该接口只有一个方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Job</span> <span class="token punctuation">{</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span>
  <span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>简单来说，Job的使命就是你将需要执行的任务逻辑，写在execute()方法中。
当一个定时任务被执行时，execute()方法由调度程序的一个线程调用。
我们可以在Job中定义自己当前作业需要执行的逻辑，如：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> jobExecutionContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">JobDetail</span> jobDetail <span class="token operator">=</span> jobExecutionContext<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">JobDataMap</span> jobDataMap <span class="token operator">=</span> jobDetail<span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    messageTemplate <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> jobDataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;messageTemplate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    scheduler <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Scheduler</span><span class="token punctuation">)</span> jobDataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;scheduler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//处理分布式的锁问题</span>
    <span class="token class-name">String</span> lockName <span class="token operator">=</span> <span class="token class-name">QuartzConstants</span><span class="token punctuation">.</span>LOCK_KEY <span class="token operator">+</span> <span class="token class-name">QuartzConstants</span><span class="token punctuation">.</span>JMS_JOIN_SIGN <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Boolean</span> absent <span class="token operator">=</span> messageTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span>lockName<span class="token punctuation">,</span> <span class="token string">&quot;task-job-lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">BooleanUtils</span><span class="token punctuation">.</span><span class="token function">isNotTrue</span><span class="token punctuation">(</span>absent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Get lock fail, current job is executing , please wait next invoke , task {}&quot;</span>
                    <span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//避免程序服务挂掉，导致锁无法释放，设定20s，避免定时任务相距时间太短，如果有问题，再调整</span>
        messageTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>lockName<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;send message error, task: {}&quot;</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">BooleanUtils</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span>absent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Free lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            messageTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>lockName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码，就定义了一个我自己的逻辑，处理多机集群时，同步触发的任务锁。</p> <h3 id="jobexecutioncontext"><a href="#jobexecutioncontext" aria-hidden="true" class="header-anchor">#</a> JobExecutionContext</h3> <p>这个对象实例，将包含作业执行过程的上下文信息，可以在执行当前任务过程中获取相应信息。同时，你也可以在创建一个定时任务时将自己需要的信息放入到该上下文中。
**注意：**JobExecutionContext对象中保存着该job运行时的一些信息 ，执行job的scheduler的引用，触发job的trigger的引用，JobDetail对象引用，以及一些其它信息。</p> <h2 id="三、jobdetail（实例化作业）"><a href="#三、jobdetail（实例化作业）" aria-hidden="true" class="header-anchor">#</a> 三、JobDetail（实例化作业）</h2> <p>上面说的Job，其实并不是真正可以执行的作业任务，它只是定义了一个作业能做什么，需要做什么事。真正需要被任务调度的其实的一个实例化Job的JobDetail。你可以有两种理解方式，一种是Job是一个父类，JobDetail是它的实现类（当然实际并不是，这里只是方便理解），二是，JobDetail类似Java中Number这样的包装类，将Job包装了一次，并且封装了更多的信息。</p> <p>如何实例化一个JobDetail呢？</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// define the job and tie it to our HelloJob class</span>
<span class="token class-name">JobDetail</span> job <span class="token operator">=</span> <span class="token function">newJob</span><span class="token punctuation">(</span><span class="token class-name">HelloJob</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;myJob&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// name &quot;myJob&quot;, group &quot;group1&quot;</span>
  <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>很简单，只需要将你需要执行的一个Job，直接丢给JobDetail就可以了。
但是要特别注意就是，你传入个Map中的对象序列号的问题，建议采用Java标准序列化。
除此之外，上文也说了，JobExecutionContext不是还可以包含一些自定义信息吗？，在这里就可以定义了。</p> <h3 id="_3-1-jobdatamap"><a href="#_3-1-jobdatamap" aria-hidden="true" class="header-anchor">#</a> 3.1. JobDataMap</h3> <p>在JobDetail中，可以使用JobDataMap来设置更多你需要带入到Job中的信息。
构建JobDetail时，可以将数据放入Map中</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// define the job and tie it to our DumbJob class</span>
<span class="token class-name">JobDetail</span> job <span class="token operator">=</span> <span class="token function">newJob</span><span class="token punctuation">(</span><span class="token class-name">DumbJob</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;myJob&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// name &quot;myJob&quot;, group &quot;group1&quot;</span>
  <span class="token punctuation">.</span><span class="token function">usingJobData</span><span class="token punctuation">(</span><span class="token string">&quot;jobSays&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">usingJobData</span><span class="token punctuation">(</span><span class="token string">&quot;myFloatValue&quot;</span><span class="token punctuation">,</span> <span class="token number">3.141f</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在Job执行过程中，可以从中取出来相应数据。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DumbJob</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">DumbJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span>
      <span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">JobKey</span> key <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">JobDataMap</span> dataMap <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">String</span> jobSays <span class="token operator">=</span> dataMap<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;jobSays&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">float</span> myFloatValue <span class="token operator">=</span> dataMap<span class="token punctuation">.</span><span class="token function">getFloat</span><span class="token punctuation">(</span><span class="token string">&quot;myFloatValue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Instance &quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot; of DumbJob says: &quot;</span> <span class="token operator">+</span> jobSays <span class="token operator">+</span> <span class="token string">&quot;, and val is: &quot;</span> <span class="token operator">+</span> myFloatValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>好了，看到这里，不知道大家有没有疑惑？为啥好多地方都定义了withIdentity这个语句？</p> <p>这里说明一下Quartz中Key的作用</p> <h3 id="_3-2-key（job或者trigger的唯一表示）"><a href="#_3-2-key（job或者trigger的唯一表示）" aria-hidden="true" class="header-anchor">#</a> 3.2. Key（Job或者Trigger的唯一表示）</h3> <p>简答来说，不管是Job还是Trigger都要有个名字，Quartz还可以对其进行分组，这两样加起来正好作为了它的唯一标识。</p> <blockquote><p>将Job和Trigger注册到Scheduler时，可以为它们设置key，配置其身份属性。Job和Trigger的key（JobKey和TriggerKey）可以用于将Job和Trigger放到不同的分组（group）里，然后基于分组进行操作。同一个分组下的Job或Trigger的名称必须唯一，即一个Job或Trigger的key由名称（name）和分组（group）组成。</p></blockquote></div> <!----> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">6/5/2019, 10:23:50 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/views/quartz/Quartz技术一.html" class="prev">
          Quartz（一）：简介及入门
        </a></span> <span class="next"><a href="/views/quartz/Quartz技术三.html">
          Quartz（三）：触发器Trigger
        </a>
        →
      </span></p></div> </main> <div class="valine-wrapper" data-v-0162251c><div id="valine" data-v-0162251c></div></div></div> <div class="back-to-ceiling" style="right:1rem;bottom:3rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;background-color:rgba(231, 234, 241,.5);display:none;" data-v-d0bfeaa4 data-v-d0bfeaa4><i class="iconfont reco-up" data-v-d0bfeaa4></i></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.95d329f1.js" defer></script><script src="/assets/js/6.e87b4649.js" defer></script><script src="/assets/js/1.3a92e369.js" defer></script><script src="/assets/js/22.25490df5.js" defer></script>
  </body>
</html>
