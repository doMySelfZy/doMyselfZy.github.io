(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{289:function(t,a,e){"use strict";e.r(a);var r=e(1),_=Object(r.a)({},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("本文主要介绍Nginx相关的基础技术，并做一些配置说明，具体实践，需要靠各位自己在实际中进行践行。")]),t._v(" "),e("h2",{attrs:{id:"一、nginx是什么？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、nginx是什么？","aria-hidden":"true"}},[t._v("#")]),t._v(" 一、Nginx是什么？")]),t._v(" "),e("p",[t._v("Nginx是一个web服务器，主要处理客户端和服务器的请求分发。")]),t._v(" "),e("h2",{attrs:{id:"二、特点和优势"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、特点和优势","aria-hidden":"true"}},[t._v("#")]),t._v(" 二、特点和优势")]),t._v(" "),e("ol",[e("li",[t._v("高并发")]),t._v(" "),e("li",[t._v("热部署")]),t._v(" "),e("li",[t._v("快")]),t._v(" "),e("li",[t._v("低功耗")]),t._v(" "),e("li",[t._v("热部署")])]),t._v(" "),e("h2",{attrs:{id:"三、使用和扩展"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、使用和扩展","aria-hidden":"true"}},[t._v("#")]),t._v(" 三、使用和扩展")]),t._v(" "),e("p",[t._v("阿里技术团队在Nginx的基础上，继承全部特性，并做了更多高级封装，延伸出一个开源框架"),e("code",[t._v("Tengine")])]),t._v(" "),e("h2",{attrs:{id:"四、概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四、概念","aria-hidden":"true"}},[t._v("#")]),t._v(" 四、概念")]),t._v(" "),e("h3",{attrs:{id:"_4-1-正向代理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-正向代理","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.1. 正向代理")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://ww1.sinaimg.cn/large/8bc108f2ly1g3q0510buxj21ww0nc41t.jpg",alt:""}})]),t._v(" "),e("p",[t._v("预先知道需要访问的服务器地址，最直接的案例就是VPN代理，明确知道国外机房服务器位置，但是访问的客户机不明。")]),t._v(" "),e("h3",{attrs:{id:"_4-2-反向代理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-反向代理","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.2. 反向代理")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://ww1.sinaimg.cn/large/8bc108f2ly1g3q050yp2jj20yg0f4wn3.jpg",alt:""}})]),t._v(" "),e("p",[t._v("预先不知道需要访问的服务器地址，因为当高并发的访问时，会对服务器进行分布式处理，不同业务进行不同的服务器部署，这个时候访问地址不明，但是客户端访问是明确的，此称为反向代理。")]),t._v(" "),e("p",[t._v("反向代理，主要用于服务器集群分布式部署的情况下，反向代理隐藏了服务器的信息")]),t._v(" "),e("h3",{attrs:{id:"_4-3-优秀的代理模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-优秀的代理模式","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.3. 优秀的代理模式")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://ww1.sinaimg.cn/large/8bc108f2ly1g3q050yt52j20yg0exdm9.jpg",alt:""}})]),t._v(" "),e("h2",{attrs:{id:"五、负载均衡"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五、负载均衡","aria-hidden":"true"}},[t._v("#")]),t._v(" 五、负载均衡")]),t._v(" "),e("p",[t._v("Nginx负载均衡算法有好几种：")]),t._v(" "),e("p",[e("code",[t._v("Weight轮询")]),t._v("（默认）：接收到的请求按照顺序逐一分配到不同的后端服务器，即使在使用过程中，某一台后端服务器宕机，nginx会自动将该服务器剔除出队列，请求受理情况不会受到任何影响。 这种方式下，可以给不同的后端服务器设置一个权重值（weight），用于调整不同的服务器上请求的分配率；权重数据越大，被分配到请求的几率越大；该权重值，主要是针对实际工作环境中不同的后端服务器硬件配置进行调整的。")]),t._v(" "),e("h2",{attrs:{id:"六、nginx命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#六、nginx命令","aria-hidden":"true"}},[t._v("#")]),t._v(" 六、Nginx命令")]),t._v(" "),e("ol",[e("li",[t._v("启动方式"),e("br"),t._v("\nwindows下："),e("code",[t._v("nginx.exe")]),e("br"),t._v("\nLinux: "),e("code",[t._v("sudo nginx")])]),t._v(" "),e("li",[t._v("关闭命令"),e("br"),t._v(" "),e("code",[t._v("nginx -s stop")]),t._v("（强制停止nginx服务器，如果有未处理的数据，丢弃）"),e("br"),t._v(" "),e("code",[t._v("nginx -s quit")]),t._v("（停止nginx服务器，如果有未处理的数据，等待处理完成之后停止）")]),t._v(" "),e("li",[t._v("重启命令"),e("br"),t._v(" "),e("code",[t._v("nginx -s reload")])])]),t._v(" "),e("h2",{attrs:{id:"七、nginx最常用的功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#七、nginx最常用的功能","aria-hidden":"true"}},[t._v("#")]),t._v(" 七、Nginx最常用的功能")]),t._v(" "),e("ol",[e("li",[t._v("反向代理")]),t._v(" "),e("li",[t._v("负载均衡")]),t._v(" "),e("li",[t._v("静态服务器")])]),t._v(" "),e("h2",{attrs:{id:"八、nginx配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#八、nginx配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 八、Nginx配置")]),t._v(" "),e("p",[e("code",[t._v("nginx.config")]),t._v("：最核心的配置文件")]),t._v(" "),e("h3",{attrs:{id:"_8-1-基础配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-基础配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 8.1. 基础配置")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("main                                # 全局配置\n\nevents {                            # nginx工作模式配置\n}\n\nhttp {                                # http设置\n    ....\n\n    server {                        # 服务器主机配置\n        ....\n        location {                    # 路由配置\n            ....\n        }\n\n        location path {\n            ....\n        }\n\n        location otherpath {\n            ....\n        }\n    }\n\n    server {\n        ....\n\n        location {\n            ....\n        }\n    }\n\n    upstream name {                    # 负载均衡配置\n        ....\n    }\n}\n")])])]),e("h3",{attrs:{id:"_8-2-main模块配置说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-main模块配置说明","aria-hidden":"true"}},[t._v("#")]),t._v(" 8.2. Main模块配置说明")]),t._v(" "),e("ol",[e("li",[t._v("user用来指定nginx worker进程运行用户以及用户组，默认nobody账号运行")]),t._v(" "),e("li",[t._v("worker_processes指定nginx要开启的子进程数量，运行过程中监控每个进程消耗内存(一般几M~几十M不等)根据实际情况进行调整，通常数量是CPU内核数量的整数倍")]),t._v(" "),e("li",[t._v("error_log定义错误日志文件的位置及输出级别【debug / info / notice / warn / error / crit】")]),t._v(" "),e("li",[t._v("pid用来指定进程id的存储文件的位置")]),t._v(" "),e("li",[t._v("worker_rlimit_nofile用于指定一个进程可以打开最多文件数量的描述")])]),t._v(" "),e("h3",{attrs:{id:"_8-3-event模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-event模块","aria-hidden":"true"}},[t._v("#")]),t._v(" 8.3. Event模块")]),t._v(" "),e("ol",[e("li",[t._v("worker_connections 指定最大可以同时接收的连接数量，这里一定要注意，最大连接数量是和worker processes共同决定的。")]),t._v(" "),e("li",[t._v("multi_accept 配置指定nginx在收到一个新连接通知后尽可能多的接受更多的连接")]),t._v(" "),e("li",[t._v("use epoll 配置指定了线程轮询的方法，如果是linux2.6+，使用epoll，如果是BSD如Mac请使用Kqueue")])]),t._v(" "),e("h3",{attrs:{id:"_8-4-http模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-http模块","aria-hidden":"true"}},[t._v("#")]),t._v(" 8.4. Http模块")]),t._v(" "),e("ul",[e("li",[t._v("sendfile on：配置on让sendfile发挥作用，将文件的回写过程交给数据缓冲去去完成，而不是放在应用中完成，这样的话在性能提升有有好处")]),t._v(" "),e("li",[t._v("tc_nopush on：让nginx在一个数据包中发送所有的头文件，而不是一个一个单独发")]),t._v(" "),e("li",[t._v("tcp_nodelay on：让nginx不要缓存数据，而是一段一段发送，如果数据的传输有实时性的要求的话可以配置它，发送完一小段数据就立刻能得到返回值，但是不要滥用哦")]),t._v(" "),e("li",[t._v("keepalive_timeout 10：给客户端分配连接超时时间，服务器会在这个时间过后关闭连接。一般设置时间较短，可以让nginx工作持续性更好")]),t._v(" "),e("li",[t._v("client_header_timeout 10：设置请求头的超时时间")]),t._v(" "),e("li",[t._v("client_body_timeout 10:设置请求体的超时时间")]),t._v(" "),e("li",[t._v("send_timeout 10：指定客户端响应超时时间，如果客户端两次操作间隔超过这个时间，服务器就会关闭这个链接")]),t._v(" "),e("li",[t._v("limit_conn_zone $binary_remote_addr zone=addr:5m ：设置用于保存各种key的共享内存的参数，")]),t._v(" "),e("li",[t._v("limit_conn addr 100: 给定的key设置最大连接数")]),t._v(" "),e("li",[t._v("server_tokens：虽然不会让nginx执行速度更快，但是可以在错误页面关闭nginx版本提示，对于网站安全性的提升有好处哦")]),t._v(" "),e("li",[t._v("include /etc/nginx/mime.types：指定在当前文件中包含另一个文件的指令")]),t._v(" "),e("li",[t._v("default_type application/octet-stream：指定默认处理的文件类型可以是二进制")]),t._v(" "),e("li",[t._v("type_hash_max_size 2048：混淆数据，影响三列冲突率，值越大消耗内存越多，散列key冲突率会降低，检索速度更快；值越小key，占用内存较少，冲突率越高，检索速度变慢")])]),t._v(" "),e("h3",{attrs:{id:"_8-5-日志配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-5-日志配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 8.5. 日志配置")]),t._v(" "),e("ul",[e("li",[t._v("access_log logs/access.log：设置存储访问记录的日志")]),t._v(" "),e("li",[t._v("error_log logs/error.log：设置存储记录错误发生的日志")])]),t._v(" "),e("h3",{attrs:{id:"_8-6-server模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-6-server模块","aria-hidden":"true"}},[t._v("#")]),t._v(" 8.6. Server模块")]),t._v(" "),e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("定义")]),t._v(" "),e("p",[t._v("sever模块配置是http模块中的一个子模块，用来定义一个虚拟访问主机，也就是一个虚拟服务器的配置信息")])]),t._v(" "),e("ul",[e("li",[t._v("server：一个虚拟主机的配置，一个http中可以配置多个server")]),t._v(" "),e("li",[t._v("server_name：用力啊指定ip地址或者域名，多个配置之间用空格分隔")]),t._v(" "),e("li",[t._v("root：表示整个server虚拟主机内的根目录，所有当前主机中web项目的根目录")]),t._v(" "),e("li",[t._v("index：用户访问web网站时的全局首页")]),t._v(" "),e("li",[t._v("charset：用于设置www/路径中配置的网页的默认编码格式")]),t._v(" "),e("li",[t._v("access_log：用于指定该虚拟主机服务器中的访问记录日志存放路径")]),t._v(" "),e("li",[t._v("error_log：用于指定该虚拟主机服务器中访问错误日志的存放路径")])]),t._v(" "),e("h3",{attrs:{id:"_8-7-location模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-7-location模块","aria-hidden":"true"}},[t._v("#")]),t._v(" 8.7. location模块")]),t._v(" "),e("p",[t._v("location模块是nginx配置中出现最多的一个配置，主要用于配置路由访问信息")]),t._v(" "),e("p",[t._v("在路由访问信息配置中关联到反向代理、负载均衡等等各项功能，所以location模块也是一个非常重要的配置模块")]),t._v(" "),e("h4",{attrs:{id:"_1-基本配置："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-基本配置：","aria-hidden":"true"}},[t._v("#")]),t._v(" (1) 基本配置：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("location / {\n            root   html;\n            index  index.html index.htm;\n        }\n")])])]),e("blockquote",[e("p",[t._v("location /：表示匹配访问根目录"),e("br"),t._v("\nroot：用于指定访问根目录时，访问虚拟主机的web目录\nindex：在不指定访问具体资源时，默认展示的资源文件列表")])]),t._v(" "),e("h4",{attrs:{id:"_2-反向代理配置方式："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-反向代理配置方式：","aria-hidden":"true"}},[t._v("#")]),t._v(" (2) 反向代理配置方式：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v(" location /ole-platform {\n            proxy_pass   http://ole-platform_sim/ole-platform;\n            proxy_set_header host $host;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            client_max_body_size 2000m;\n        }\n")])])]),e("h4",{attrs:{id:"_3-upstream模块："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-upstream模块：","aria-hidden":"true"}},[t._v("#")]),t._v(" (3) upstream模块：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v(" upstream ueditor_sim {\n      server   192.168.1.178:8312;\n    }\n")])])]),e("p",[t._v("upstream模块主要负责负载均衡的配置，通过默认的轮询调度方式来分发请求到后端服务器")]),t._v(" "),e("blockquote",[e("p",[t._v("ip_hash：指定请求调度算法，默认是weight权重轮询调度，可以指定"),e("br"),t._v("\nserver host:port：分发服务器的列表配置")])]),t._v(" "),e("h4",{attrs:{id:"_4-带权重的配置："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-带权重的配置：","aria-hidden":"true"}},[t._v("#")]),t._v(" (4) 带权重的配置：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("upstream test {\n    server 192.168.0.1 weight=5;\n    ip_hash;\n    server 192.168.0.2 weight=7;\n}\n")])])])])},[],!1,null,null,null);a.default=_.exports}}]);